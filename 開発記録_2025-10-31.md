# 開発記録 2025年10月31日

## 作業内容

### 1. ダッシュボード：拠点別成績カードの実装
**目的**: 各拠点（本部、豊中、奈良、京都、西宮）ごとの経営成績を可視化

**実装内容**:
- 既存の複雑な「拠点別経営状況」セクション（全社サマリー含む）を削除
- 新しい簡潔な拠点別成績カードを3列レイアウトで作成
- 各カードに以下の指標を表示：
  - 売上（百万円）
  - 粗利益（百万円）
  - 粗利率（%）- 色分け（緑≥15%、黄10-15%、赤<10%）
  - 従業員数
  - 契約数
  - 進行中プロジェクト数
  - 1人当たり契約数

**実装上の課題と解決**:
- 問題：初回実装で拠点カードが表示されなかった
- 原因：`calculateBranchStats`関数が`branches`ステート変数に依存しており、初期化タイミングの問題で空配列のまま処理されていた
- 解決：関数内で拠点リストを直接定義することで、ステート変数への依存を解消

**デモモード制限**:
- 拠点別成績カードは**デモモードON時のみ表示**
- 本番データ使用時（デモモードOFF）は非表示

### 2. 商品構成グラフ：商品マスタ連携
**目的**: 商品構成グラフを商品マスタから動的に取得

**実装内容**:
- デモプロジェクトに`product`リレーション（商品マスタ）を追加
- 商品マスタの実際の商品名を使用：
  - LIFE（スタンダードな高性能住宅プラン）
  - LIFE+（LIFEのアップグレード版）
  - HOURS（時間を楽しむ住まい）
  - LACIE（デザイン性重視プラン）
  - LIFE X（LIFE究極進化版）

**変更前**: `product_type`フィールドのハードコードされた値（「スタンダードプラン」など）を使用
**変更後**: `product.name`から商品マスタの正式名称を取得

## コミット履歴

1. **3e59d00** - 拠点別成績カードを簡潔化：全社サマリー削除＋見やすい3列レイアウト
2. **fc6685c** - 拠点別成績をデモモードのみ表示に変更
3. **36bfc6f** - 修正：商品マスタ連携＋拠点別成績カード表示問題を解決

## デプロイ

- 本番URL: https://g-progress.vercel.app
- 最新デプロイ: https://g-progress-l8lc1wp83-ghouse-developments-projects.vercel.app

## 技術的なポイント

### calculateBranchStats関数の修正
```typescript
// 修正前：ステート変数に依存
const stats: BranchStats[] = branches.map(branch => { ... })

// 修正後：関数内で拠点リストを定義
const branchList = [
  { id: '1', name: '本部' },
  { id: '2', name: '豊中' },
  { id: '3', name: '奈良' },
  { id: '4', name: '京都' },
  { id: '5', name: '西宮' }
]
const stats: BranchStats[] = branchList.map(branch => { ... })
```

### デモプロジェクトへの商品マスタ追加
```typescript
const products = generateDemoProducts()
{
  id: 'demo-project-1',
  product_id: products[0].id,
  product: products[0],  // <- 追加
  ...
}
```

## 次回作業予定

- なし（本日で作業完了）

## 備考

- 全ての変更はビルド・デプロイが正常に完了
- デモモードでの動作確認が必要
